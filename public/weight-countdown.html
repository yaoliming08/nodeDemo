<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡è‚¥å€’è®¡æ—¶ - è·ç¦»ç›®æ ‡æ—¥æœŸ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1600px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
            display: flex;
            gap: 30px;
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        .date-list-section {
            width: 400px;
            min-width: 350px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 80px);
        }

        .date-list-header {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-list-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .date-list-container::-webkit-scrollbar {
            width: 8px;
        }

        .date-list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .date-list-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .date-list-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .date-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .date-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateX(5px);
        }

        .date-item.today {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);
        }

        .date-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .date-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .date-day {
            font-size: 12px;
            color: #999;
            margin-left: 8px;
        }

        .date-weight-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .date-weight-input label {
            font-size: 14px;
            color: #666;
            min-width: 60px;
        }

        .date-weight-input input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .date-weight-input input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .date-weight-input .unit {
            font-size: 14px;
            color: #666;
            min-width: 20px;
        }

        .date-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .date-stat-item {
            flex: 1;
            text-align: center;
        }

        .date-stat-label {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
        }

        .date-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        .date-stat-value.lost {
            color: #28a745;
        }

        .date-stat-value.remaining {
            color: #ff6b6b;
        }

        .date-photos {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .date-photos-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .date-photos-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .date-photo-item {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .date-photo-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .date-photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .date-photo-delete {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            background: rgba(255, 68, 68, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .date-photo-item:hover .date-photo-delete {
            opacity: 1;
        }

        .date-photo-upload {
            width: 60px;
            height: 60px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .date-photo-upload:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .date-photo-upload input {
            display: none;
        }

        .date-photo-upload-icon {
            font-size: 24px;
            color: #999;
        }

        .photo-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .photo-preview-modal.show {
            display: flex;
        }

        .photo-preview-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .photo-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-preview-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .empty-date-list {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-date-list-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 18px;
            color: #666;
        }

        .countdown-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .countdown-title {
            font-size: 24px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .countdown-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px 30px;
            min-width: 120px;
            backdrop-filter: blur(10px);
        }

        .countdown-number {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .countdown-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .countdown-message {
            font-size: 20px;
            margin-top: 20px;
            font-weight: 600;
        }

        .weight-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .weight-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .weight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .weight-card-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .weight-card-value {
            font-size: 42px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .weight-card-unit {
            font-size: 18px;
            color: #999;
        }

        .progress-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-title {
            font-size: 24px;
            color: #333;
            font-weight: 600;
        }

        .progress-percentage {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar-container {
            background: #e0e0e0;
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .motivation-section {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-top: 30px;
        }

        .motivation-text {
            font-size: 20px;
            color: #333;
            font-weight: 600;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 28px;
            }

            .countdown-display {
                gap: 15px;
            }

            .countdown-item {
                min-width: 80px;
                padding: 15px 20px;
            }

            .countdown-number {
                font-size: 36px;
            }

            .weight-card-value {
                font-size: 32px;
            }

            .progress-title {
                font-size: 20px;
            }

            .progress-percentage {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1>ğŸ¯ å‡è‚¥å€’è®¡æ—¶</h1>
                <p>è·ç¦»ç›®æ ‡æ—¥æœŸè¿˜æœ‰</p>
            </div>

        <div class="countdown-section">
            <div class="countdown-title">â° å€’è®¡æ—¶</div>
            <div class="countdown-display">
                <div class="countdown-item">
                    <div class="countdown-number" id="days">0</div>
                    <div class="countdown-label">å¤©</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="hours">0</div>
                    <div class="countdown-label">å°æ—¶</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="minutes">0</div>
                    <div class="countdown-label">åˆ†é’Ÿ</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-number" id="seconds">0</div>
                    <div class="countdown-label">ç§’</div>
                </div>
            </div>
            <div class="countdown-message" id="countdownMessage"></div>
        </div>

        <div class="weight-info-grid">
            <div class="weight-card">
                <div class="weight-card-title">åˆå§‹ä½“é‡</div>
                <div class="weight-card-value">265</div>
                <div class="weight-card-unit">æ–¤</div>
            </div>
            <div class="weight-card">
                <div class="weight-card-title">å½“å‰ä½“é‡</div>
                <div class="weight-card-value" id="currentWeight">251</div>
                <div class="weight-card-unit">æ–¤</div>
            </div>
            <div class="weight-card">
                <div class="weight-card-title">å·²å‡é‡é‡</div>
                <div class="weight-card-value" style="color: #28a745;">14</div>
                <div class="weight-card-unit">æ–¤</div>
            </div>
            <div class="weight-card">
                <div class="weight-card-title">ç›®æ ‡å‡é‡</div>
                <div class="weight-card-value" style="color: #667eea;">50</div>
                <div class="weight-card-unit">æ–¤</div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-header">
                <div class="progress-title">ğŸ“Š å‡è‚¥è¿›åº¦</div>
                <div class="progress-percentage" id="progressPercentage">28%</div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 28%;">
                    14 / 50 æ–¤
                </div>
            </div>
            <div class="progress-info">
                <span>è¿˜éœ€å‡é‡: <strong id="remainingWeight">36</strong> æ–¤</span>
                <span>ç›®æ ‡ä½“é‡: <strong>215</strong> æ–¤</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“…</div>
                <div class="stat-value" id="daysSinceStart">4</div>
                <div class="stat-label">å‡è‚¥å¤©æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">âš¡</div>
                <div class="stat-value" id="dailyAverage">3.5</div>
                <div class="stat-label">æ—¥å‡å‡é‡(æ–¤)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ¯</div>
                <div class="stat-value" id="daysToGoal">46</div>
                <div class="stat-label">é¢„è®¡å®Œæˆå¤©æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”¥</div>
                <div class="stat-value" id="remainingDays">46</div>
                <div class="stat-label">è·ç¦»ç›®æ ‡æ—¥æœŸå¤©æ•°</div>
            </div>
        </div>

        <div class="motivation-section">
            <div class="motivation-text" id="motivationText">
                ğŸ’ª åŠ æ²¹ï¼ä½ å·²ç»å‡äº†14æ–¤ï¼Œç»§ç»­ä¿æŒè¿™ä¸ªåŠ¿å¤´ï¼
            </div>
        </div>

        <div class="action-buttons">
            <a href="/index.html" class="btn btn-secondary">è¿”å›é¦–é¡µ</a>
        </div>
        </div>

        <div class="date-list-section">
            <div class="date-list-header">
                <span>ğŸ“…</span>
                <span>æ¯æ—¥ä½“é‡è®°å½•</span>
            </div>
            <div class="date-list-container" id="dateListContainer">
                <div class="empty-date-list" id="emptyDateList">
                    <div class="empty-date-list-icon">ğŸ“</div>
                    <p>æ­£åœ¨åŠ è½½æ—¥æœŸåˆ—è¡¨...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç…§ç‰‡é¢„è§ˆæ¨¡æ€æ¡† -->
    <div class="photo-preview-modal" id="photoPreviewModal" onclick="this.classList.remove('show')">
        <div class="photo-preview-close" onclick="event.stopPropagation(); document.getElementById('photoPreviewModal').classList.remove('show')">Ã—</div>
        <img id="photoPreviewImg" src="" alt="é¢„è§ˆ" onclick="event.stopPropagation()">
    </div>

    <script>
        // é…ç½®æ•°æ®
        const config = {
            initialWeight: 265,      // åˆå§‹ä½“é‡ï¼ˆæ–¤ï¼‰
            currentWeight: 251,       // å½“å‰ä½“é‡ï¼ˆæ–¤ï¼‰
            lostWeight: 14,           // å·²å‡é‡é‡ï¼ˆæ–¤ï¼‰
            targetWeight: 50,         // ç›®æ ‡å‡é‡ï¼ˆæ–¤ï¼‰
            startDate: '2026-01-04',  // å¼€å§‹æ—¥æœŸï¼ˆ2026å¹´1æœˆ4æ—¥ï¼‰
            newYearDate: '2026-02-15' // ç›®æ ‡æ—¥æœŸï¼ˆ2026å¹´2æœˆ15æ—¥ï¼‰
        };

        // ä½“é‡æ•°æ®å­˜å‚¨ï¼ˆä½¿ç”¨APIï¼‰
        let weightRecordsCache = {}; // ç¼“å­˜æ•°æ®
        
        // ä»APIè·å–æ‰€æœ‰è®°å½•åˆ—è¡¨
        async function fetchAllRecords() {
            try {
                console.log('ğŸ“¡ æ­£åœ¨è°ƒç”¨åˆ—è¡¨æ¥å£: /api/weight-records');
                const response = await fetch('/api/weight-records', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    cache: 'no-cache' // ç¦ç”¨ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®
                });
                
                console.log('ğŸ“¥ æ¥å£å“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“¦ æ¥å£è¿”å›æ•°æ®:', result);
                
                if (result.success && result.data && Array.isArray(result.data)) {
                    // æ¸…ç©ºç¼“å­˜å¹¶é‡æ–°å¡«å……
                    weightRecordsCache = {};
                    result.data.forEach(record => {
                        // ç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®ï¼ˆç»Ÿä¸€ä¸º YYYY-MM-DDï¼‰
                        let recordDate = record.record_date;
                        if (recordDate) {
                            // å¦‚æœæ˜¯ISOæ ¼å¼å­—ç¬¦ä¸²ï¼Œæå–æ—¥æœŸéƒ¨åˆ†
                            if (typeof recordDate === 'string') {
                                recordDate = recordDate.split('T')[0].split(' ')[0];
                            } else if (recordDate instanceof Date) {
                                recordDate = recordDate.toISOString().split('T')[0];
                            }
                        }
                        
                        weightRecordsCache[recordDate] = {
                            id: record.id,
                            user_id: record.user_id,
                            record_date: recordDate,
                            weight: parseFloat(record.weight) || 0,
                            initial_weight: parseFloat(record.initial_weight) || 0,
                            target_weight: parseFloat(record.target_weight) || 0,
                            target_loss: parseFloat(record.target_loss) || 0,
                            lost_weight: parseFloat(record.lost_weight) || 0,
                            remaining_weight: parseFloat(record.remaining_weight) || 0,
                            photos: record.photos || [],
                            notes: record.notes || null,
                            created_at: record.created_at,
                            updated_at: record.updated_at
                        };
                    });
                    console.log(`âœ… ä»åˆ—è¡¨æ¥å£åŠ è½½äº† ${result.data.length} æ¡å†å²è®°å½•`);
                    console.log('ğŸ“‹ ç¼“å­˜æ•°æ®:', weightRecordsCache);
                    console.log('ğŸ“… ç¼“å­˜ä¸­çš„æ—¥æœŸ:', Object.keys(weightRecordsCache));
                    return weightRecordsCache;
                } else {
                    console.warn('âš ï¸ æ¥å£è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®:', result);
                    if (result.data === null || result.data === undefined) {
                        console.log('â„¹ï¸ å½“å‰æ²¡æœ‰å†å²è®°å½•æ•°æ®');
                        weightRecordsCache = {};
                    }
                }
            } catch (err) {
                console.error('âŒ è·å–è®°å½•åˆ—è¡¨å¤±è´¥:', err);
                console.error('é”™è¯¯è¯¦æƒ…:', err.message);
            }
            return weightRecordsCache;
        }

        // è·å–æŒ‡å®šæ—¥æœŸçš„è®°å½•ï¼ˆä»ç¼“å­˜ä¸­è·å–ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰åˆ™é‡æ–°åŠ è½½åˆ—è¡¨ï¼‰
        async function getRecordByDate(date) {
            // å…ˆä»ç¼“å­˜è·å–
            if (weightRecordsCache[date]) {
                return weightRecordsCache[date];
            }
            // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œé‡æ–°åŠ è½½æ‰€æœ‰è®°å½•åˆ—è¡¨
            await fetchAllRecords();
            return weightRecordsCache[date] || null;
        }

        // ç”Ÿæˆæ—¥æœŸåˆ—è¡¨ï¼ˆä»å¼€å§‹æ—¥æœŸåˆ°ä»Šå¤©ï¼Œä¸æ˜¾ç¤ºæœªæ¥æ—¥æœŸï¼‰
        function generateDateList() {
            const start = new Date(config.startDate + 'T00:00:00');
            const today = new Date();
            // ä½¿ç”¨æœ¬åœ°æ—¶åŒºï¼Œç¡®ä¿ä»Šå¤©è¢«åŒ…å«
            today.setHours(23, 59, 59, 999); // è®¾ç½®ä¸ºä»Šå¤©çš„æœ€åä¸€åˆ»ï¼Œç¡®ä¿åŒ…å«ä»Šå¤©
            
            const dates = [];
            const current = new Date(start);
            const todayStr = formatDate(new Date()); // ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆç”¨äºæ¯”è¾ƒï¼‰
            
            // åªç”Ÿæˆåˆ°ä»Šå¤©ä¸ºæ­¢çš„æ—¥æœŸï¼ˆåŒ…å«ä»Šå¤©ï¼‰
            while (current <= today) {
                const dateStr = formatDate(current);
                const currentDateStr = formatDate(new Date()); // å½“å‰æ—¥æœŸå­—ç¬¦ä¸²
                const isToday = dateStr === currentDateStr; // ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œé¿å…æ—¶åŒºé—®é¢˜
                const isPast = dateStr < currentDateStr;
                
                dates.push({
                    date: dateStr,
                    dateObj: new Date(current),
                    isToday: isToday,
                    isPast: isPast,
                    canEdit: true // æ‰€æœ‰æ˜¾ç¤ºçš„æ—¥æœŸéƒ½å¯ä»¥ç¼–è¾‘
                });
                
                current.setDate(current.getDate() + 1);
                // é‡ç½®æ—¶é—´éƒ¨åˆ†ï¼Œé¿å…æ—¶åŒºé—®é¢˜
                current.setHours(0, 0, 0, 0);
            }
            
            console.log(`ğŸ“… ç”Ÿæˆäº† ${dates.length} ä¸ªæ—¥æœŸé¡¹ï¼Œä» ${dates[0]?.date} åˆ° ${dates[dates.length - 1]?.date}`);
            return dates;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDateDisplay(date, isToday = false) {
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekday = weekdays[date.getDay()];
            let display = `${month}æœˆ${day}æ—¥ å‘¨${weekday}`;
            
            // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ˜¾ç¤ºæ—¶é—´
            if (isToday) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                display += ` ${hours}:${minutes}:${seconds}`;
            }
            
            return display;
        }

        // æ¸²æŸ“æ—¥æœŸåˆ—è¡¨
        async function renderDateList() {
            const container = document.getElementById('dateListContainer');
            const emptyList = document.getElementById('emptyDateList');
            const dates = generateDateList();
            
            console.log(`ğŸ“… ç”Ÿæˆäº† ${dates.length} ä¸ªæ—¥æœŸé¡¹`);
            
            // ç¡®ä¿æ•°æ®å·²åŠ è½½ï¼ˆå¦‚æœç¼“å­˜ä¸ºç©ºï¼Œé‡æ–°åŠ è½½ï¼‰
            if (Object.keys(weightRecordsCache).length === 0) {
                console.log('âš ï¸ ç¼“å­˜ä¸ºç©ºï¼Œé‡æ–°åŠ è½½æ•°æ®...');
                await fetchAllRecords();
            }
            
            console.log(`ğŸ“‹ å½“å‰ç¼“å­˜ä¸­æœ‰ ${Object.keys(weightRecordsCache).length} æ¡è®°å½•`);
            
            if (dates.length === 0) {
                emptyList.style.display = 'block';
                return;
            }
            
            emptyList.style.display = 'none';
            container.innerHTML = '';
            
            dates.forEach(dateInfo => {
                const dateItem = document.createElement('div');
                dateItem.className = `date-item ${dateInfo.isToday ? 'today' : ''}`;
                
                // æŸ¥æ‰¾å¯¹åº”æ—¥æœŸçš„è®°å½•ï¼ˆæ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼åŒ¹é…ï¼‰
                let record = weightRecordsCache[dateInfo.date] || null;
                
                // å¦‚æœç›´æ¥åŒ¹é…ä¸åˆ°ï¼Œå°è¯•æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„æ—¥æœŸæ ¼å¼
                if (!record) {
                    const cacheKeys = Object.keys(weightRecordsCache);
                    for (const key of cacheKeys) {
                        // æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼è¿›è¡Œæ¯”è¾ƒ
                        const normalizedKey = key.split('T')[0].split(' ')[0];
                        const normalizedDate = dateInfo.date.split('T')[0].split(' ')[0];
                        if (normalizedKey === normalizedDate) {
                            record = weightRecordsCache[key];
                            // æ›´æ–°ç¼“å­˜é”®ä¸ºæ ‡å‡†æ ¼å¼
                            if (key !== normalizedDate) {
                                weightRecordsCache[normalizedDate] = {
                                    ...record,
                                    record_date: normalizedDate
                                };
                                delete weightRecordsCache[key];
                            }
                            break;
                        }
                    }
                }
                
                // è°ƒè¯•æ—¥å¿—ï¼šæ˜¾ç¤ºåŒ¹é…ç»“æœ
                if (record) {
                    console.log(`âœ… æ—¥æœŸ ${dateInfo.date} åŒ¹é…åˆ°è®°å½•:`, {
                        record_date: record.record_date,
                        weight: record.weight
                    });
                }
                
                // å¦‚æœæœ‰è®°å½•ä¸”ä½“é‡å¤§äº0ï¼Œä½¿ç”¨è®°å½•çš„ä½“é‡ï¼›å¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²
                const weight = record && record.weight > 0 ? record.weight : '';
                const lostWeight = record && record.lost_weight !== undefined && record.lost_weight !== null ? parseFloat(record.lost_weight).toFixed(1) : '';
                const remainingWeight = record && record.remaining_weight !== undefined && record.remaining_weight !== null ? parseFloat(record.remaining_weight).toFixed(1) : '';
                const photos = record ? (record.photos || []) : [];
                
                // è°ƒè¯•æ—¥å¿—ï¼ˆä»…åœ¨æœ‰è®°å½•æ—¶è¾“å‡ºï¼‰
                if (record) {
                    console.log(`ğŸ“ æ—¥æœŸ ${dateInfo.date} æœ‰è®°å½• - ä½“é‡: ${weight}, å·²å‡: ${lostWeight}, å¾…å‡: ${remainingWeight}, ç…§ç‰‡æ•°: ${photos.length}`);
                } else {
                    console.log(`ğŸ“ æ—¥æœŸ ${dateInfo.date} æ— è®°å½•`);
                }
                
                dateItem.innerHTML = `
                    <div class="date-item-header">
                        <div>
                            <span class="date-label">${dateInfo.date}</span>
                            <span class="date-day" id="date-day-${dateInfo.date}">${formatDateDisplay(dateInfo.dateObj, dateInfo.isToday)}</span>
                            ${dateInfo.isToday ? '<span style="color: #28a745; font-size: 12px; margin-left: 8px;">ä»Šå¤©</span>' : ''}
                        </div>
                    </div>
                    <div class="date-weight-input">
                        <label>ä½“é‡:</label>
                        <input 
                            type="number" 
                            step="0.1" 
                            min="0" 
                            max="9999.99"
                            value="${weight}" 
                            placeholder="è¾“å…¥ä½“é‡"
                            data-date="${dateInfo.date}"
                            ${!dateInfo.canEdit ? 'disabled' : ''}
                            onchange="updateWeight('${dateInfo.date}', this.value)"
                            oninput="validateWeight(this)"
                        >
                        <span class="unit">æ–¤</span>
                    </div>
                    ${weight ? `
                    <div class="date-stats">
                        <div class="date-stat-item">
                            <div class="date-stat-label">å·²å‡</div>
                            <div class="date-stat-value lost">${lostWeight} æ–¤</div>
                        </div>
                        <div class="date-stat-item">
                            <div class="date-stat-label">å¾…å‡</div>
                            <div class="date-stat-value remaining">${remainingWeight} æ–¤</div>
                        </div>
                    </div>
                    ` : ''}
                    ${dateInfo.canEdit ? `
                    <div class="date-photos">
                        <div class="date-photos-label">ç…§ç‰‡:</div>
                        <div class="date-photos-list">
                            ${photos.map((photo, index) => `
                                <div class="date-photo-item" onclick="previewPhoto('${photo}')">
                                    <img src="${photo}" alt="ç…§ç‰‡${index + 1}">
                                    <div class="date-photo-delete" onclick="event.stopPropagation(); deletePhoto('${dateInfo.date}', '${photo}')">Ã—</div>
                                </div>
                            `).join('')}
                            <div class="date-photo-upload" onclick="handlePhotoUploadClick('${dateInfo.date}')">
                                <input type="file" accept="image/*" multiple id="photo-input-${dateInfo.date}" data-date="${dateInfo.date}" onchange="uploadPhotos('${dateInfo.date}', this.files)" style="display: none;">
                                <div class="date-photo-upload-icon">ğŸ“·</div>
                            </div>
                        </div>
                    </div>
                    ` : photos.length > 0 ? `
                    <div class="date-photos">
                        <div class="date-photos-label">ç…§ç‰‡:</div>
                        <div class="date-photos-list">
                            ${photos.map((photo, index) => `
                                <div class="date-photo-item" onclick="previewPhoto('${photo}')">
                                    <img src="${photo}" alt="ç…§ç‰‡${index + 1}">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                `;
                
                container.appendChild(dateItem);
            });
            
            // æ»šåŠ¨åˆ°ä»Šå¤©çš„ä½ç½®
            const todayItem = container.querySelector('.date-item.today');
            if (todayItem) {
                todayItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ¯ç§’æ›´æ–°æ—¶é—´æ˜¾ç¤º
            const todayDate = formatDate(new Date());
            const todayDayElement = document.getElementById(`date-day-${todayDate}`);
            if (todayDayElement) {
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                if (window.dateTimeUpdateInterval) {
                    clearInterval(window.dateTimeUpdateInterval);
                }
                // æ¯ç§’æ›´æ–°æ—¶é—´
                window.dateTimeUpdateInterval = setInterval(() => {
                    const todayDayEl = document.getElementById(`date-day-${todayDate}`);
                    if (todayDayEl) {
                        const todayDateObj = new Date();
                        todayDayEl.textContent = formatDateDisplay(todayDateObj, true);
                    } else {
                        clearInterval(window.dateTimeUpdateInterval);
                    }
                }, 1000);
            }
        }

        // éªŒè¯ä½“é‡è¾“å…¥
        function validateWeight(input) {
            const value = parseFloat(input.value);
            if (isNaN(value) || value < 0) {
                input.setCustomValidity('ä½“é‡å¿…é¡»å¤§äºç­‰äº0');
            } else if (value > 9999.99) {
                input.setCustomValidity('ä½“é‡ä¸èƒ½è¶…è¿‡9999.99æ–¤');
            } else {
                input.setCustomValidity('');
            }
        }

        // æ›´æ–°ä½“é‡æ•°æ®
        async function updateWeight(date, weight) {
            const weightNum = parseFloat(weight);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(weightNum) || weightNum < 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½“é‡å€¼ï¼ˆå¤§äºç­‰äº0ï¼‰');
                return;
            }
            
            if (weightNum > 9999.99) {
                alert('ä½“é‡å€¼ä¸èƒ½è¶…è¿‡9999.99æ–¤');
                return;
            }
            
            // å¦‚æœè¾“å…¥ä¸ºç©ºæˆ–0ï¼Œåˆ é™¤è®°å½•
            if (!weight || weight.trim() === '' || weightNum === 0) {
                // åˆ é™¤æ•°æ®
                try {
                    const response = await fetch(`/api/weight-records/${date}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    if (result.success) {
                        delete weightRecordsCache[date];
                    }
                } catch (err) {
                    console.error('åˆ é™¤è®°å½•å¤±è´¥:', err);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                    return;
                }
            } else {
                // ä¿å­˜æ•°æ®åˆ°API
                try {
                    const formData = new FormData();
                    formData.append('date', date);
                    formData.append('weight', weightNum);
                    formData.append('initial_weight', config.initialWeight);
                    formData.append('target_weight', config.initialWeight - config.targetWeight);
                    formData.append('target_loss', config.targetWeight);
                    
                    const response = await fetch('/api/weight-records', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        // ç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®
                        const resultDate = result.data.record_date;
                        const normalizedDate = typeof resultDate === 'string' ? resultDate.split('T')[0].split(' ')[0] : resultDate;
                        weightRecordsCache[normalizedDate] = {
                            ...result.data,
                            record_date: normalizedDate
                        };
                    } else {
                        alert('ä¿å­˜å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                        return;
                    }
                } catch (err) {
                    console.error('ä¿å­˜è®°å½•å¤±è´¥:', err);
                    alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
                    return;
                }
            }
            
            // æ›´æ–°å½“å‰ä½“é‡ï¼ˆä½¿ç”¨æœ€æ–°çš„ä½“é‡æ•°æ®ï¼‰
            await updateCurrentWeight();
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            await renderDateList();
            
            // é‡æ–°è®¡ç®—è¿›åº¦
            calculateProgress();
        }

        // å¤„ç†ç…§ç‰‡ä¸Šä¼ æŒ‰é’®ç‚¹å‡»
        function handlePhotoUploadClick(date) {
            const input = document.getElementById(`photo-input-${date}`);
            if (input) {
                input.click();
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°è¯•é€šè¿‡data-dateæŸ¥æ‰¾
                const inputByDate = document.querySelector(`input[data-date="${date}"]`);
                if (inputByDate) {
                    inputByDate.click();
                } else {
                    console.error(`æ‰¾ä¸åˆ°æ—¥æœŸ ${date} çš„ç…§ç‰‡ä¸Šä¼ è¾“å…¥æ¡†`);
                }
            }
        }

        // ä¸Šä¼ ç…§ç‰‡
        async function uploadPhotos(date, files) {
            if (!files || files.length === 0) return;
            
            const formData = new FormData();
            formData.append('date', date);
            // å¦‚æœè¯¥æ—¥æœŸå·²æœ‰è®°å½•ï¼Œä½¿ç”¨ç°æœ‰ä½“é‡ï¼›å¦åˆ™éœ€è¦å…ˆè¾“å…¥ä½“é‡
            const existingRecord = weightRecordsCache[date];
            if (existingRecord && existingRecord.weight) {
                formData.append('weight', existingRecord.weight);
            } else {
                // å¦‚æœæ²¡æœ‰ä½“é‡æ•°æ®ï¼Œæç¤ºç”¨æˆ·å…ˆè¾“å…¥ä½“é‡
                alert('è¯·å…ˆè¾“å…¥è¯¥æ—¥æœŸçš„ä½“é‡ï¼Œç„¶åå†ä¸Šä¼ ç…§ç‰‡');
                return;
            }
            formData.append('initial_weight', config.initialWeight);
            formData.append('target_weight', config.initialWeight - config.targetWeight);
            formData.append('target_loss', config.targetWeight);
            
            // æ·»åŠ ç…§ç‰‡æ–‡ä»¶
            Array.from(files).forEach(file => {
                formData.append('photos', file);
            });
            
            try {
                const response = await fetch('/api/weight-records', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.success) {
                    // æ›´æ–°ç¼“å­˜ï¼Œç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®
                    const resultDate = result.data.record_date;
                    const normalizedDate = typeof resultDate === 'string' ? resultDate.split('T')[0].split(' ')[0] : resultDate;
                    weightRecordsCache[normalizedDate] = {
                        ...result.data,
                        record_date: normalizedDate
                    };
                    // é‡æ–°æ¸²æŸ“åˆ—è¡¨ä»¥æ˜¾ç¤ºæ–°ä¸Šä¼ çš„ç…§ç‰‡
                    await renderDateList();
                    console.log('âœ… ç…§ç‰‡ä¸Šä¼ æˆåŠŸ');
                } else {
                    alert('ä¸Šä¼ å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (err) {
                console.error('ä¸Šä¼ ç…§ç‰‡å¤±è´¥:', err);
                alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆ é™¤ç…§ç‰‡
        async function deletePhoto(date, photoUrl) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ')) return;
            
            const filename = photoUrl.split('/').pop();
            try {
                const response = await fetch(`/api/weight-records/${date}/photos/${filename}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (result.success) {
                    const record = weightRecordsCache[date];
                    if (record) {
                        record.photos = result.data.photos;
                    }
                    await renderDateList();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (err) {
                console.error('åˆ é™¤ç…§ç‰‡å¤±è´¥:', err);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // é¢„è§ˆç…§ç‰‡
        function previewPhoto(photoUrl) {
            const modal = document.getElementById('photoPreviewModal');
            const img = document.getElementById('photoPreviewImg');
            img.src = photoUrl;
            modal.classList.add('show');
        }

        // æ›´æ–°å½“å‰ä½“é‡ï¼ˆä»æœ€æ–°è®°å½•ä¸­è·å–ï¼‰
        async function updateCurrentWeight() {
            await fetchAllRecords();
            
            const dates = Object.keys(weightRecordsCache).filter(date => {
                const dateObj = new Date(date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return dateObj <= today; // åªè€ƒè™‘ä»Šå¤©åŠä¹‹å‰çš„æ—¥æœŸ
            }).sort().reverse();
            
            if (dates.length > 0) {
                const latestDate = dates[0];
                const latestRecord = weightRecordsCache[latestDate];
                const latestWeight = latestRecord.weight;
                const displayWeight = latestWeight % 1 === 0 ? latestWeight : latestWeight.toFixed(1);
                document.getElementById('currentWeight').textContent = displayWeight;
                
                // æ›´æ–°å·²å‡é‡é‡
                const lostWeight = latestRecord.lost_weight;
                const lostWeightElement = document.querySelector('.weight-card:nth-child(3) .weight-card-value');
                if (lostWeightElement) {
                    const displayLost = lostWeight % 1 === 0 ? lostWeight : lostWeight.toFixed(1);
                    lostWeightElement.textContent = displayLost;
                }
                
                // æ›´æ–°é…ç½®
                config.currentWeight = latestWeight;
                config.lostWeight = lostWeight;
            }
        }

        // è®¡ç®—è·ç¦»ç›®æ ‡æ—¥æœŸçš„å€’è®¡æ—¶
        function updateCountdown() {
            const now = new Date();
            const targetDate = new Date(config.newYearDate + ' 00:00:00');
            const diff = targetDate - now;

            if (diff <= 0) {
                document.getElementById('days').textContent = '0';
                document.getElementById('hours').textContent = '0';
                document.getElementById('minutes').textContent = '0';
                document.getElementById('seconds').textContent = '0';
                document.getElementById('countdownMessage').textContent = 'ğŸ‰ ç›®æ ‡æ—¥æœŸå·²åˆ°ï¼';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = days;
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');

            // æ›´æ–°è·ç¦»ç›®æ ‡æ—¥æœŸçš„å¤©æ•°
            document.getElementById('remainingDays').textContent = days;
            
            // æ›´æ–°å€’è®¡æ—¶æç¤ºä¿¡æ¯
            if (days > 0) {
                document.getElementById('countdownMessage').textContent = `è·ç¦» ${config.newYearDate} è¿˜æœ‰ ${days} å¤©`;
            } else {
                document.getElementById('countdownMessage').textContent = `è·ç¦» ${config.newYearDate} è¿˜æœ‰ä¸åˆ°1å¤©`;
            }
            
            // æ›´æ–°å€’è®¡æ—¶æç¤ºä¿¡æ¯
            if (days > 0) {
                document.getElementById('countdownMessage').textContent = `è·ç¦» ${config.newYearDate} è¿˜æœ‰ ${days} å¤©`;
            } else {
                document.getElementById('countdownMessage').textContent = `è·ç¦» ${config.newYearDate} è¿˜æœ‰ä¸åˆ°1å¤©`;
            }
        }

        // è®¡ç®—å‡è‚¥è¿›åº¦
        function calculateProgress() {
            const progress = (config.lostWeight / config.targetWeight) * 100;
            const remainingWeight = config.targetWeight - config.lostWeight;
            const targetFinalWeight = config.initialWeight - config.targetWeight;

            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
            document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
            document.getElementById('remainingWeight').textContent = remainingWeight;

            // è®¡ç®—å‡è‚¥å¤©æ•°ï¼ˆä»Šå¤©æ˜¯ç¬¬4å¤©ï¼‰
            const daysSinceStart = 4; // å›ºå®šä¸ºç¬¬4å¤©
            document.getElementById('daysSinceStart').textContent = daysSinceStart;

            // è®¡ç®—æ—¥å‡å‡é‡
            const dailyAverage = (config.lostWeight / daysSinceStart).toFixed(1);
            document.getElementById('dailyAverage').textContent = dailyAverage;

            // è®¡ç®—é¢„è®¡å®Œæˆå¤©æ•°ï¼ˆåŸºäºå½“å‰é€Ÿåº¦ï¼‰
            if (dailyAverage > 0) {
                const daysToGoal = Math.ceil(remainingWeight / dailyAverage);
                document.getElementById('daysToGoal').textContent = daysToGoal;
            }

            // æ›´æ–°æ¿€åŠ±è¯­
            updateMotivation(progress);
        }

        // æ›´æ–°æ¿€åŠ±è¯­
        function updateMotivation(progress) {
            const motivations = [
                { min: 0, max: 20, text: 'ğŸ’ª å¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠï¼Œç»§ç»­åŠ æ²¹ï¼' },
                { min: 20, max: 40, text: 'ğŸ”¥ ä½ å·²ç»å®Œæˆäº†' + Math.round(progress) + '%ï¼Œä¿æŒè¿™ä¸ªåŠ¿å¤´ï¼' },
                { min: 40, max: 60, text: 'â­ å¤ªæ£’äº†ï¼ä½ å·²ç»å‡äº†' + config.lostWeight + 'æ–¤ï¼Œç»§ç»­åŠªåŠ›ï¼' },
                { min: 60, max: 80, text: 'ğŸ¯ æ¥è¿‘ç›®æ ‡äº†ï¼åšæŒå°±æ˜¯èƒœåˆ©ï¼' },
                { min: 80, max: 100, text: 'ğŸ† å¤ªå‰å®³äº†ï¼ä½ é©¬ä¸Šå°±è¦è¾¾æˆç›®æ ‡äº†ï¼' }
            ];

            const motivation = motivations.find(m => progress >= m.min && progress < m.max);
            if (motivation) {
                document.getElementById('motivationText').textContent = motivation.text;
            }
        }

        // åˆå§‹åŒ–
        async function init() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–é¡µé¢...');
            
            try {
                // å…ˆåŠ è½½æ‰€æœ‰å†å²æ•°æ®ï¼ˆä»åˆ—è¡¨æ¥å£ï¼‰
                console.log('ğŸ“¡ æ­¥éª¤1: è°ƒç”¨åˆ—è¡¨æ¥å£åŠ è½½å†å²æ•°æ®...');
                await fetchAllRecords();
                console.log('ğŸ“‹ ç¼“å­˜æ•°æ®:', weightRecordsCache);
                console.log('ğŸ“Š ç¼“å­˜è®°å½•æ•°:', Object.keys(weightRecordsCache).length);
                
                // æ›´æ–°å€’è®¡æ—¶
                console.log('â° æ­¥éª¤2: æ›´æ–°å€’è®¡æ—¶...');
                updateCountdown();
                
                // æ›´æ–°å½“å‰ä½“é‡å’Œè¿›åº¦
                console.log('ğŸ“Š æ­¥éª¤3: æ›´æ–°å½“å‰ä½“é‡å’Œè¿›åº¦...');
                await updateCurrentWeight();
                calculateProgress();
                
                // æ¸²æŸ“æ—¥æœŸåˆ—è¡¨ï¼ˆä¼šæ˜¾ç¤ºæ‰€æœ‰å†å²æ•°æ®ï¼‰
                console.log('ğŸ¨ æ­¥éª¤4: æ¸²æŸ“æ—¥æœŸåˆ—è¡¨...');
                await renderDateList();
                
                console.log('âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            } catch (err) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', err);
                console.error('é”™è¯¯å †æ ˆ:', err.stack);
            }
            
            // æ¯ç§’æ›´æ–°å€’è®¡æ—¶
            setInterval(updateCountdown, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

